<app-progress *ngIf="dataLoading"></app-progress>

<main id="main" class="main" (keypress)="keyPress($event)">

    <div class="pagetitle">
        <h1>Medicine Sale
            <a class="text-link" style="float: right;font-size: 14px;" [routerLink]="'/admin/medicine-sale-list'">
                Medicine
                Sale List</a>
        </h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a routerLink="/admin/admin-dashboard">Home</a></li>
                <li class="breadcrumb-item">Pharmacy</li>
                <li class="breadcrumb-item active">Medicine Sale</li>
            </ol>
        </nav>
    </div>
    <section class="section">
        <div class="row">
            <div class="col-12">
                <div class="card recent-sales pt-3">
                    <div class="card-body">
                        <div class="row form-group">
                            <label class="form-label col-sm-2">Select Medicine<span class="text-danger">*</span></label>
                            <!-- <div class="col-sm-5">
                                <ng-autocomplete [data]="MedicineList" [searchKeyword]="'SearchMedicine'"
                                    placeholder="Enter Medicine Name/HSN Code" id="MedicineAutoComplete"
                                    (selected)='afterMedicineSelected($event)' name="MedicineAutoComplete"
                                    [itemTemplate]="MedicineItemTemplate" [notFoundTemplate]="MedicineNotFoundTemplate"
                                    #MedicineAutoComplete="ngModel" [(ngModel)]="PaymentMedicine.MedicineAutoComplete"
                                    [isLoading]="dataLoading" (inputCleared)="clearMedicine()" [minQueryLength]="1"
                                    [autofocus]="true">
                                </ng-autocomplete>
                                
                                <ng-template #MedicineItemTemplate let-item>
                                    <a [innerHTML]="item.SearchMedicine"></a>
                                </ng-template>

                                <ng-template #MedicineNotFoundTemplate let-notFound>
                                    <div>
                                        <a>Not found..</a>
                                    </div>
                                </ng-template>
                                <div *ngIf="MedicineAutoComplete.invalid && (MedicineAutoComplete.dirty || MedicineAutoComplete.touched)"
                                    class="text-danger">
                                    <div *ngIf="MedicineAutoComplete.errors?.['required']">
                                        Medicine is required.
                                    </div>
                                </div>
                            </div> -->
                            <mat-form-field appearance="outline" class="col-lg-3">
                                <mat-label> Select Medicine </mat-label>
                                <input matInput #MedicineId="ngModel" name="MedicineName"
                                  (ngModelChange)="onSearchInput($event)" placeholder="Search By Medicine"
                                    [(ngModel)]="PaymentMedicine.MedicineName" [matAutocomplete]="autoMedicine"
                                    required />
                                <mat-autocomplete #autoMedicine="matAutocomplete"
                                    (optionSelected)="afterMedicineSelected($event)">
                                    <mat-option *ngFor="let options of MedicineDetailList" [id]="options.MedicineId"
                                        [value]="options.MedicineName">{{
                                        options.MedicineName }}</mat-option>
                                </mat-autocomplete>
                                <button mat-icon-button matSuffix *ngIf="PaymentMedicine.MedicineName" color="primary"
                                    (click)="clearMedicine()">
                                    <mat-icon><i class="ri-close-circle-line"></i> </mat-icon>
                                </button>
                                <mat-error>Required field !!</mat-error>
                            </mat-form-field>
                        </div>
                        <div *ngIf="MedicineStockList.length>0">
                            <div class="form-group row">
                                <h6>Available Stocks</h6>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-sm" id="table_list">
                                        <thead class="thead-light">
                                            <tr>
                                                <th>Batch No</th>
                                                <!-- <th>Manufactured Date</th> -->
                                                <th>Expired Date</th>
                                                <th>MRP</th>
                                                <!-- <th>Available Stock</th> -->
                                                <th>Available Stock</th>
                                                <th>Unit</th>
                                                <th>Selling Unit</th>
                                                <th>Selling Quantity</th>
                                                <th>Amount</th>
                                                <th>Discount(%)</th>
                                                <th>Discount(₹)</th>
                                                <th>GST(%)</th>
                                                <th>GST(₹)</th>
                                                <th>Line Total</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let model of MedicineStockList">
                                                <td>{{model.BatchNo}}</td>
                                                <!-- <td>{{model.ManufacturedDate |date:'dd-MM-yyyy'}}</td> -->
                                                <td>{{model.ExpiredDate |date:'dd-MM-yyyy'}}</td>
                                                <td>{{model.MRP }}</td>
                                                <!-- <td>{{model.StripValue + ( model.StripPeice > 0 ? " , " +
                                                    model.StripPeice : '')}}</td> -->
                                                <td>{{model.AvailableQuantity}}</td>
                                                <td>{{model.UnitName}}</td>
                                                <td>
                                                    <select class="form-select" (change)="changeQuantity(model)">
                                                        <option value="24">Pics</option>
                                                        <option *ngFor="let unit of UnitList" [value]="unit.UnitId">
                                                            {{ unit.UnitName }}
                                                        </option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="number" class="no-spinner" [(ngModel)]="model.Quantity"
                                                        (change)="changeQuantity(model)" style="width:100%" />
                                                </td>
                                                <td>{{model.Amount }}</td>
                                                <td>
                                                    <input type="number" class="no-spinner"
                                                        [(ngModel)]="model.DiscountPercentages"
                                                        (change)="changeQuantity(model)" style="width:100%" />
                                                </td>
                                                <td>
                                                    <input type="number" class="no-spinner"
                                                        [(ngModel)]="model.DiscountAmount"
                                                        (change)="changeQuantity(model,true)" style="width:100%" />
                                                </td>
                                                <td>
                                                    <select [(ngModel)]="model.GSTId" (change)="calculateGST(model)">
                                                        <option value="">GST</option>
                                                        <option *ngFor="let r1 of GSTList" [value]="r1.GSTId">
                                                            {{r1.GSTName}}</option>
                                                    </select>
                                                </td>
                                                <td>{{model.TotalGSTAmount }}</td>
                                                <td>{{model.TotalAmount }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-sm-12 text-center">
                                    <!-- <button class="btn btn-sm btn-success" (click)="addMedicine()"><i
                                            class="fa fa-plus"></i> Add</button> -->
                                    <button mat-raised-button color="primary" (click)="addMedicine()">Add</button>

                                </div>
                            </div>
                        </div>

                        <div class="list-group" *ngIf="PaymentMedicineList.length > 0">
                            <h5>Medicines</h5>
                            <div class="table-responsive">
                                <table class="table table-bordered  table-sm">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>#</th>
                                            <th>Medicine</th>
                                            <th>HSN Code</th>
                                            <th>Batch No</th>
                                            <!-- <th>Manufactured Date</th> -->
                                            <th>Expired Date</th>
                                            <th>Unit</th>
                                            <th>Quantity</th>
                                            <th>Amount</th>
                                            <th>Discount(%)</th>
                                            <th>Discount(₹)</th>
                                            <th>Taxable Amount</th>
                                            <th>GST(%)</th>
                                            <th>GST(₹)</th>
                                            <th>Line Total</th>
                                            <th>Remove</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let model of PaymentMedicineList;let i = index">
                                            <td>{{i+1}}</td>
                                            <td>{{model.MedicineName}}</td>
                                            <td>{{model.HSNCode}}</td>
                                            <td>{{model.BatchNo}}</td>
                                            <!-- <td>{{model.ManufacturedDate |date:'dd-MM-yyyy'}}</td> -->
                                            <td>{{model.ExpiredDate |date:'dd-MM-yyyy'}}</td>
                                            <td>
                                                <select [(ngModel)]="model.UnitId" (change)="changeQuantity(model)">
                                                    <option *ngFor="let p1 of UnitList" [value]="p1.UnitId">
                                                        {{p1.UnitName}}</option>
                                                </select>
                                            </td>
                                            <td>
                                                <input type="number" [(ngModel)]="model.Quantity"
                                                    (change)="changeQuantity(model)" style="width:80px" />
                                            </td>
                                            <td>{{model.Amount}}</td>
                                            <td>
                                                <input type="number" [(ngModel)]="model.DiscountPercentages"
                                                    (change)="changeQuantity(model)" style="width:80px" />
                                            </td>
                                            <td>
                                                <input type="number" [(ngModel)]="model.DiscountAmount"
                                                    (change)="changeQuantity(model,true)" style="width:80px" />
                                            </td>
                                            <td>{{model.TaxableAmount}}</td>
                                            <td>
                                                <select [(ngModel)]="model.GSTId" (change)="calculateGST(model)">
                                                    <option value="">GST</option>
                                                    <option *ngFor="let p1 of GSTList" [value]="p1.GSTId">
                                                        {{p1.GSTName}}</option>
                                                </select>
                                            </td>
                                            <td>{{model.TotalGSTAmount }}</td>
                                            <td>{{model.TotalAmount }}</td>
                                            <td>
                                                <button class="btn btn-sm btn-danger"
                                                    (click)="removePaymentMedicine(i)"><i
                                                        class="bi bi-trash-fill"></i></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="list-group" style="margin-top: 10px;" *ngIf="PaymentMedicineList.length > 0">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <h5 class="card-title">Payment Details</h5>
                                            <form #formPaymentCollection="ngForm">
                                                <div class="row">
                                                   
                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Billing Of <span
                                                    class="text-danger">*</span></label>
                                            <select #BillingOf="ngModel" [(ngModel)]="PaymentCollection.BillingOf"
                                                name="BillingOf" class="form-select" (change)="calulateTotal()"
                                                [ngClass]="{'is-invalid': submitted && BillingOf.invalid}" required
                                                autofocus>
                                                <option value="">--Select--</option>
                                                <option value="1">OPD</option>
                                                <option value="2">IPD</option>
                                                <option value="3">General</option>

                                            </select>

                                            <div *ngIf="BillingOf.invalid && (BillingOf.dirty || BillingOf.touched )"
                                                class="text-danger">
                                                <div *ngIf="BillingOf.errors?.['required']">
                                                    Billing Of is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <!-- <div class="col-sm-4 form-group" *ngIf="(PaymentCollection.BillingOf == 1)">
                                            <label class="form-label">Select OPD Patient <span
                                                    class="text-danger">*</span></label>
                                            <ng-autocomplete [data]="AllPatientList" [searchKeyword]="'SearchPatient'"
                                                placeholder="Enter Patient Name/Code"
                                                (selected)='afterPatientSelected($event)' name="PatientAutoComplete"
                                                [itemTemplate]="PatientItemTemplate"
                                                [notFoundTemplate]="PatientNotFoundTemplate"
                                                #PatientAutoComplete="ngModel"
                                                [(ngModel)]="PaymentMedicine.PatientAutoComplete"
                                                [isLoading]="dataLoading" (inputCleared)="clearPatient()"
                                                [minQueryLength]="1" required [autofocus]="true">
                                            </ng-autocomplete>

                                            <ng-template #PatientItemTemplate let-item>
                                                <a [innerHTML]="item.SearchPatient"></a>
                                            </ng-template>

                                            <ng-template #PatientNotFoundTemplate let-notFound>
                                                <div>
                                                    <a>Not found..</a>
                                                </div>
                                            </ng-template>
                                            <div *ngIf="PatientAutoComplete.invalid && (PatientAutoComplete.dirty || PatientAutoComplete.touched)"
                                                class="text-danger">
                                                <div *ngIf="PatientAutoComplete.errors?.['required']">
                                                    Patient is required.
                                                </div>
                                            </div>
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Patient Name / Mobile / UHID</mat-label>
                                                            <input matInput name="PackageCollectionName"
                                                                [(ngModel)]="PaymentCollection.PatientName"
                                                                (ngModelChange)="filterpatientList($event)"
                                                                [matAutocomplete]="autoTransportPackageCollection"
                                                                placeholder="Search By Package Collection" required />

                                                            <mat-autocomplete
                                                                #autoTransportPackageCollection="matAutocomplete"
                                                                (optionSelected)="afterPatientSelected($event)">
                                                                <mat-option *ngFor="let option of filteredPatientList"
                                                                    [value]="option.PatientName">
                                                                    {{ option.PatientName }} / {{ option.UHID }} /
                                                                    {{ option.ContactNo }}
                                                                </mat-option>
                                                            </mat-autocomplete>

                                                            <button mat-icon-button matSuffix
                                                                *ngIf="PaymentMedicine.PatientName" color="primary"
                                                                (click)="clearPatient()">
                                                                <mat-icon>close</mat-icon>
                                                            </button>

                                                            <mat-error *ngIf="!PaymentMedicine.PatientName">Required
                                                                field
                                                                !!</mat-error>
                                                        </mat-form-field>

                                                        <!-- <div class="col-sm-4 form-group" *ngIf="(PaymentCollection.BillingOf == 2)">
                                            <label class="form-label">Select IPD Patient <span
                                                    class="text-danger">*</span></label>
                                            <ng-autocomplete [data]="AllIPDPatientList"
                                                [searchKeyword]="'SearchPatient'" placeholder="Enter Patient Name/Code"
                                                (selected)='afterIPDPatientSelected($event)'
                                                name="IPDPatientAutoComplete" [itemTemplate]="PatientItemTemplate"
                                                [notFoundTemplate]="PatientNotFoundTemplate"
                                                #IPDPatientAutoComplete="ngModel"
                                                [(ngModel)]="PaymentMedicine.IPDPatientAutoComplete"
                                                [isLoading]="dataLoading" (inputCleared)="clearIPDPatient()"
                                                [minQueryLength]="1" required [autofocus]="true">
                                            </ng-autocomplete>

                                            <ng-template #PatientItemTemplate let-item>
                                                <a [innerHTML]="item.SearchPatient"></a>
                                            </ng-template>

                                            <ng-template #PatientNotFoundTemplate let-notFound>
                                                <div>
                                                    <a>Not found..</a>
                                                </div>
                                            </ng-template>
                                            <div *ngIf="IPDPatientAutoComplete.invalid && (IPDPatientAutoComplete.dirty || IPDPatientAutoComplete.touched)"
                                                class="text-danger">
                                                <div *ngIf="IPDPatientAutoComplete.errors?.['required']">
                                                    Patient is required.
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-sm-4 form-group" *ngIf="(PaymentCollection.BillingOf == 3)">
                                            <label class="form-label">Select General Patient <span
                                                    class="text-danger">*</span></label>
                                            <ng-autocomplete [data]="AllGeneralPatientList"
                                                [searchKeyword]="'SearchPatient'" placeholder="Enter Patient Name/Code"
                                                (selected)='afterGeneralPatientSelected($event)'
                                                name="GenerealPatientAutoComplete" [itemTemplate]="PatientItemTemplate"
                                                [notFoundTemplate]="PatientNotFoundTemplate"
                                                #GenerealPatientAutoComplete="ngModel"
                                                [(ngModel)]="PaymentMedicine.GenerealPatientAutoComplete"
                                                [isLoading]="dataLoading" (inputCleared)="clearGeneralPatient()"
                                                [minQueryLength]="1" required [autofocus]="true">
                                            </ng-autocomplete>

                                            <ng-template #PatientItemTemplate let-item>
                                                <a [innerHTML]="item.SearchPatient"></a>
                                            </ng-template>

                                            <ng-template #PatientNotFoundTemplate let-notFound>
                                                <div>
                                                    <a>Not found..</a>
                                                </div>
                                            </ng-template>
                                            <div *ngIf="GenerealPatientAutoComplete.invalid && (GenerealPatientAutoComplete.dirty || GenerealPatientAutoComplete.touched)"
                                                class="text-danger">
                                                <div *ngIf="GenerealPatientAutoComplete.errors?.['required']">
                                                    Patient is required.
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-lg-1 form-group" *ngIf="(PaymentCollection.BillingOf == 3)">
                                            <label class="form-label">Add Patient</label>
                                            <br>
                                            <button class="btn btn-primary" name="addProduct"
                                                (click)="openPatientForm()">Patient</button>
                                        </div>

                                        <div class="col-sm-2 form-group">
                                            <label class="form-label">Total Discount <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #DiscountAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.DiscountAmount" name="DiscountAmount"
                                                class="form-control">
                                        </div> -->

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Total CGST <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #CGSTAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.CGSTAmount" name="CGSTAmount"
                                                class="form-control">
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Total CGST</mat-label>
                                                            <input matInput type="number" #CGSTAmount="ngModel"
                                                                name="CGSTAmount"
                                                                [(ngModel)]="PaymentCollection.CGSTAmount" required
                                                                readonly="true" />
                                                        </mat-form-field>

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Total SGST <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #SGSTAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.SGSTAmount" name="SGSTAmount"
                                                class="form-control">
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Total SGST</mat-label>
                                                            <input matInput type="number" #SGSTAmount="ngModel"
                                                                name="SGSTAmount"
                                                                [(ngModel)]="PaymentCollection.SGSTAmount" required
                                                                readonly="true" />
                                                        </mat-form-field>

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Total IGST <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #IGSTAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.IGSTAmount" name="IGSTAmount"
                                                class="form-control">
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Total IGST</mat-label>
                                                            <input matInput type="number" #IGSTAmount="ngModel"
                                                                name="IGSTAmount"
                                                                [(ngModel)]="PaymentCollection.IGSTAmount" required
                                                                readonly="true" />
                                                        </mat-form-field>

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Total Payable Amount <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #PayableAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.PayableAmount" name="PayableAmount"
                                                class="form-control">
                                        </div> -->


                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Net Amount <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #NetPayableAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.NetPayableAmount" name="NetPayableAmount"
                                                class="form-control">
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Net Amount </mat-label>
                                                            <input matInput type="number" #NetPayableAmount="ngModel"
                                                                name="NetPayableAmount"
                                                                [(ngModel)]="PaymentCollection.NetPayableAmount"
                                                                required readonly="true" />
                                                        </mat-form-field>

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Disc. on Bill <span
                                                    class="text-danger">*</span></label>
                                            <input type="number" placeholder="Disc." #DiscOnBill="ngModel"
                                                [(ngModel)]="PaymentCollection.DiscOnBill" name="DiscOnBill"
                                                (change)="calulateTotal()" class="form-control">

                                        </div> -->
<!-- 
                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Disc. on Bill </mat-label>
                                                            <input matInput type="number" #DiscOnBill="ngModel"
                                                                name="DiscOnBill"
                                                                [(ngModel)]="PaymentCollection.DiscOnBill"
                                                                (change)="calulateTotal()" />
                                                        </mat-form-field> -->

                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Paid Amount <span
                                                    class="text-danger">*</span></label>
                                            <input type="number" placeholder="Paid Amount" #PaidAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.PaidAmount" name="PaidAmount"
                                                (change)="calulateTotal(true)" class="form-control"
                                                [ngClass]="{'is-invalid': submitted && PaidAmount.invalid}" required
                                                autofocus>

                                            <div *ngIf="PaidAmount.invalid && (PaidAmount.dirty || PaidAmount.touched )"
                                                class="text-danger">
                                                <div *ngIf="PaidAmount.errors?.['required']">
                                                    Paid Amount is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Payable Amount </mat-label>
                                                            <input class="no-spinner" matInput type="number"
                                                                #PayableAmount="ngModel" name="PayableAmount"
                                                                [(ngModel)]="PaymentCollection.PayableAmount" required
                                                                (change)="calulateTotal(true)" />
                                                            <mat-error
                                                                *ngIf=" PayableAmount.dirty || PayableAmount.touched ||(PayableAmount.invalid &&submitted)">
                                                                Payable Amount is <strong>required</strong>
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <!-- 
                                        <div class="col-sm-2 form-group">
                                            <label class="form-label">Dues Amount <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" disabled="disabled" #DueAmount="ngModel"
                                                [(ngModel)]="PaymentCollection.DueAmount" name="DueAmount"
                                                class="form-control">
                                        </div> -->
<!-- 
                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Dues Amount </mat-label>
                                                            <input matInput type="number" #DueAmount="ngModel"
                                                                name="DueAmount"
                                                                [(ngModel)]="PaymentCollection.DueAmount" required
                                                                readonly="true" />
                                                        </mat-form-field> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Due Amount </mat-label>
                                                            <input matInput type="number" #DueAmount="ngModel"
                                                                name="DueAmount"
                                                                [(ngModel)]="PaymentCollection.DueAmount"
                                                                required readonly="true" />
                                                        </mat-form-field>


                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Payment Mode <span
                                                    class="text-danger">*</span></label>
                                            <select #PaymentMode="ngModel" [(ngModel)]="PaymentCollection.PaymentMode"
                                                name="PaymentMode" class="form-select">
                                                [ngClass]="{'is-invalid': submitted && PaymentMode.invalid}" required
                                                autofocus>
                                                <option value="">--Select Payment Mode--</option>
                                                <option *ngFor="let m1 of PaymentModeList" [value]="m1.Key">{{m1.Value}}
                                                </option>
                                            </select>

                                            <div *ngIf="PaymentMode.invalid && (PaymentMode.dirty || PaymentMode.touched )"
                                                class="text-danger">
                                                <div *ngIf="PaymentMode.errors?.['required']">
                                                    Payment Mode is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Transaction No (if Any)</label>
                                            <input type="text" placeholder="Transaction No" #TransactionNo="ngModel"
                                                [(ngModel)]="PaymentCollection.TransactionNo" name="TransactionNo"
                                                class="form-control"
                                                [ngClass]="{'is-invalid': submitted && TransactionNo.invalid}">

                                            <div *ngIf="TransactionNo.invalid && (TransactionNo.dirty || TransactionNo.touched )"
                                                class="text-danger">
                                                <div *ngIf="TransactionNo.errors?.['required']">
                                                    Transaction No is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Payment Date <span
                                                    class="text-danger">*</span></label>
                                            <input type="date" placeholder="Payment Date" #PaymentDate="ngModel"
                                                [(ngModel)]="PaymentCollection.PaymentDate" name="PaymentDate"
                                                class="form-control"
                                                [ngClass]="{'is-invalid': submitted && PaymentDate.invalid}" required
                                                autofocus>

                                            <div *ngIf="PaymentDate.invalid && (PaymentDate.dirty || PaymentDate.touched )"
                                                class="text-danger">
                                                <div *ngIf="PaymentDate.errors?.['required']">
                                                    Payment Date is required.
                                                </div>
                                            </div>
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Payment Date</mat-label>
                                                            <input matInput [matDatepicker]="pickers"
                                                                [(ngModel)]="PaymentCollection.PaymentDate"
                                                                name="PaymentDate" required />
                                                            <mat-datepicker-toggle matSuffix [for]="pickers"
                                                                class="small-datepicker-icon"></mat-datepicker-toggle>
                                                            <mat-datepicker #pickers></mat-datepicker>
                                                        </mat-form-field>
                                                        <!-- <div class="col-sm-12 form-group">
                                            <label class="form-label">Remark</label>
                                            <textarea placeholder="Remarks" #Remarks="ngModel"
                                                [(ngModel)]="PaymentCollection.Remarks" name="Remarks"
                                                class="form-control"
                                                [ngClass]="{'is-invalid': submitted && Remarks.invalid}"></textarea>

                                            <div *ngIf="Remarks.invalid && (Remarks.dirty || Remarks.touched )"
                                                class="text-danger">
                                                <div *ngIf="Remarks.errors?.['required']">
                                                    Remarks is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <mat-form-field appearance="outline" class="col-lg-6">
                                                            <mat-label>Doctor Remarks</mat-label>
                                                            <input matInput name="Remarks"
                                                                [(ngModel)]="PaymentCollection.Remarks" />
                                                        </mat-form-field>


                                                        <!-- <div class="col-sm-2 form-group" *ngIf="(PaymentCollection.BillingOf != 3)">
                                            <label class="form-label">Doctor</label>
                                            <ng-autocomplete [data]="DoctorList" [searchKeyword]="'DoctorName'"
                                                placeholder="Enter Doctor Name" id="DoctorAutoComplete"
                                                (selected)='afterDoctorSelected($event)' name="DoctorAutoComplete"
                                                [itemTemplate]="DoctorItemTemplate"
                                                [notFoundTemplate]="DoctorNotFoundTemplate"
                                                #DoctorAutoComplete="ngModel"
                                                [(ngModel)]="PaymentCollection.DoctorAutoComplete"
                                                [isLoading]="dataLoading" (inputCleared)="clearDoctor()"
                                                [minQueryLength]="1" [autofocus]="true">
                                            </ng-autocomplete>

                                            <ng-template #DoctorItemTemplate let-item>
                                                <a [innerHTML]="item.DoctorName"></a>
                                            </ng-template>

                                            <ng-template #DoctorNotFoundTemplate let-notFound>
                                                <div>
                                                    <a>Not found..</a>
                                                </div>
                                            </ng-template>
                                            <div *ngIf="DoctorAutoComplete.invalid && (DoctorAutoComplete.dirty || DoctorAutoComplete.touched)"
                                                class="text-danger">
                                                <div *ngIf="DoctorAutoComplete.errors?.['required']">
                                                    Doctor is required.
                                                </div>
                                            </div>
                                        </div> -->

                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Doctor Name </mat-label>
                                                            <input matInput #UnitId="ngModel" name="UnitName"
                                                                (ngModelChange)="filterDoctorList($event)"
                                                                placeholder="Search By Doctor"
                                                                [(ngModel)]="PaymentCollection.DoctorName"
                                                                [matAutocomplete]="autoDoctor" />
                                                            <mat-autocomplete #autoDoctor="matAutocomplete"
                                                                (optionSelected)="afterDoctorSelected($event)">
                                                                <mat-option *ngFor="let options of DoctorDetailList"
                                                                    [id]="options.DoctorId"
                                                                    [value]="options.DoctorName">{{
                                                                    options.DoctorName }}</mat-option>
                                                            </mat-autocomplete>
                                                            <button mat-icon-button matSuffix
                                                                *ngIf="PaymentCollection.DoctorName" color="primary"
                                                                (click)="clearDoctor()">
                                                                <mat-icon><i class="ri-close-circle-line"></i>
                                                                </mat-icon>
                                                            </button>
                                                        </mat-form-field>
                                                        <!-- <div class="col-sm-2 form-group">
                                            <label class="form-label">Reffered Name<span
                                                    class="text-danger">*</span></label>
                                            <input type="text" placeholder="RefferedByName" #RefferedByName="ngModel"
                                                [(ngModel)]="PaymentCollection.RefferedByName" name="RefferedByName"
                                                class="form-control"
                                                [ngClass]="{'is-invalid': submitted && RefferedByName.invalid}" required
                                                autofocus>

                                            <div *ngIf="RefferedByName.invalid && (RefferedByName.dirty || RefferedByName.touched )"
                                                class="text-danger">
                                                <div *ngIf="RefferedByName.errors?.['required']">
                                                    RefferedByName is required.
                                                </div>
                                            </div>
                                        </div> -->
                                                        <mat-form-field appearance="outline" class="col-lg-3">
                                                            <mat-label>Reffered Name </mat-label>
                                                            <input matInput type="text" #RefferedByName="ngModel"
                                                                name="RefferedByName"
                                                                [(ngModel)]="PaymentCollection.RefferedByName"
                                                                required />
                                                        </mat-form-field>

                                                    </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="section" *ngIf="PaymentMedicineList.length > 0">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Payment Collection</h5>
                                        <form #formPaymentCollection="ngForm">
                                            <div class="row">
                                                <!-- Remarks -->
                                                <mat-form-field appearance="outline" class="col-lg-6">
                                                    <mat-label>Remarks</mat-label>
                                                    <input matInput name="Remarks"
                                                        [(ngModel)]="currentPayment.Remarks" />
                                                </mat-form-field>

                                                <!-- Amount -->
                                                <mat-form-field appearance="outline" class="col-lg-2">
                                                    <mat-label>Amount</mat-label>
                                                    <input matInput type="number" name="PaidAmount"
                                                        [(ngModel)]="currentPayment.PaidAmount" required
                                                        class="no-spinner" />
                                                </mat-form-field>

                                                <!-- PaymentMode -->
                                                <mat-form-field appearance="outline" class="col-sm-3">
                                                    <mat-label>Payment Mode</mat-label>
                                                    <mat-select #PaymentMode="ngModel" name="PaymentMode"
                                                        [(ngModel)]="currentPayment.PaymentMode" required
                                                        class="no-spinner">
                                                        <mat-option [value]="PaymentMode.Key"
                                                            *ngFor="let PaymentMode of PaymentModeList">{{
                                                            PaymentMode.Value }}</mat-option>
                                                    </mat-select>
                                                    <mat-error *ngIf="
                      PaymentMode.dirty ||
                      PaymentMode.touched ||
                      (PaymentMode.invalid && submitted)
                    ">
                                                        Payment Mode is <strong>required</strong>
                                                    </mat-error>
                                                </mat-form-field>

                                                <!-- Add Button -->
                                                <div class="col-sm-1 align-items-end">
                                                    <button mat-flat-button color="primary" (click)="addToPaymentList()"
                                                        type="button">
                                                        ADD
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Payment Table -->
                                            <div *ngIf="SelectedPaymentCollectionList.length > 0" class="mt-3">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered table-hover">
                                                        <thead class="thead-light">
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Remarks</th>
                                                                <th>Amount</th>
                                                                <th>Payment Mode</th>
                                                                <th>Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr *ngFor="
                          let item of SelectedPaymentCollectionList;
                          let i = index
                        ">
                                                                <td>{{ i + 1 }}</td>
                                                                <td>{{ item.Remarks }}</td>
                                                                <td>{{ item.PaidAmount }}</td>
                                                                <td>{{ AllPaymentModeList[item.PaymentMode] }}</td>
                                                                <td>
                                                                    <button class="btn btn-sm btn-danger"
                                                                        (click)="removePaymentItem(i)">
                                                                        <i class="bi bi-trash-fill"></i>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer text-center" *ngIf="PaymentMedicineList.length > 0">
                        <button type="button" class="btn btn-primary" (click)="saveMedicalPayment()">Sumbit</button>
                    </div>
                </div>
            </div>
        </div>

    </section>
</main>
<div id="modal_popUp" class="modal fade">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{{patient.patientId > 0 ? 'Update' : 'New'}} Patient</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form #myForm="ngForm">
                    <div class="row">
                        <div class="col-sm-2 form-group">
                            <label class="form-label">Patient Name</label>
                            <input type="text" placeholder="Enter patient Name" #PatientName="ngModel"
                                [(ngModel)]="patient.PatientName" name="PatientName" class="form-control"
                                [ngClass]="{'is-invalid':submitted && PatientName.invalid}" required autofocus>

                            <div *ngIf="PatientName.invalid && (PatientName.dirty || PatientName.touched || submitted)"
                                class="text-danger">
                                <div *ngIf="PatientName.errors?.['required']">
                                    Patient Name is required.
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2 form-group">
                            <label class="form-label">AGE</label>
                            <input type="text" placeholder="Enter AGE" #AGE="ngModel" [(ngModel)]="patient.AGE"
                                name="AGE" class="form-control" [ngClass]="{'is-invalid':submitted && AGE.invalid}"
                                required autofocus>

                            <div *ngIf="AGE.invalid && (AGE.dirty || AGE.touched || submitted)" class="text-danger">
                                <div *ngIf="AGE.errors?.['required']">
                                    AGE is required.
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-2 form-group">
                            <label class="form-label">GENDER</label>
                            <select type="text" placeholder="Enter Mobile No" #Gender="ngModel"
                                [(ngModel)]="patient.Gender" name="Gender" class="form-control"
                                [ngClass]="{'is-invalid':submitted && Gender.invalid}" required autofocus>
                                <option value="">--Select Gender--</option>
                                <option [value]="model.Key" *ngFor="let model of GenderList">
                                    {{model.Value}}</option>
                            </select>

                            <div *ngIf="Gender.invalid && (Gender.dirty || Gender.touched || submitted)"
                                class="text-danger">
                                <div *ngIf="Gender.errors?.['required']">
                                    Gender is required.
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3 form-group">
                            <label class="form-label">ADDRESS</label>
                            <textarea placeholder="Enter Address" #Address="ngModel" [(ngModel)]="patient.Address"
                                name="Address" class="form-control"
                                [ngClass]="{'is-invalid':submitted && Address.invalid}" required autofocus>
                            </textarea>
                            <div *ngIf="Address.invalid && (Address.dirty || Address.touched || submitted)"
                                class="text-danger">
                                <div *ngIf="Address.errors?.['required']">
                                    Address is required.
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3 form-group">
                            <label class="form-label">Mobile No.</label>
                            <input type="text" placeholder="Enter Mobile" #MobileNo="ngModel"
                                [(ngModel)]="patient.MobileNo" name="MobileNo" class="form-control"
                                [ngClass]="{'is-invalid':submitted && MobileNo.invalid}" required autofocus>

                            <div *ngIf="MobileNo.invalid && (MobileNo.dirty || MobileNo.touched || submitted)"
                                class="text-danger">
                                <div *ngIf="MobileNo.errors?.['required']">
                                    Mobile No. is required.
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" (click)="savePatient()" class="btn btn-primary">Save</button>
            </div>

        </div>
    </div>
</div>